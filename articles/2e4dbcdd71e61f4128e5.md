---
title: "Github Actionsã«ã‚ˆã‚‹Pythonã®ã‚³ãƒ¼ãƒ‰æ•´å½¢ã¨ã‚³ãƒŸãƒƒãƒˆã‚’è‡ªå‹•åŒ–"
emoji: "ğŸ°"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["python", "githubactions"]
published: true
---

# èƒŒæ™¯

Pythonã§é–‹ç™ºã—ã¦ã„ã‚‹æ™‚ã€ä½•ã‚‰ã‹ã®ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼(blackã¨ã‹yapfã¨ã‹autopep8ã¨ã‹)ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹ã“ã¨ãŒå¤šã„ã¨æ€ã„ã¾ã™ã€‚
ãã—ã¦ã€ãŠãã‚‰ãçš†ã•ã‚“ã„ã‚ã„ã‚ãªã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚„æ–¹æ³•ã§ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼ã‚’å®Ÿè¡Œã—ã¦ã„ã‚‹ã¯ãšã§ã™ã€‚

- ã‚³ãƒŸãƒƒãƒˆå‰ã«æ‰‹å‹•ã§å®Ÿè¡Œ
- [pre-commit](https://github.com/pre-commit/pre-commit)ã§è¨­å®šã—ã¦ãŠã„ã¦ã‚³ãƒŸãƒƒãƒˆå‰ã«å•é¡Œãªã„ã‹ãƒã‚§ãƒƒã‚¯ã—ã¦æ€’ã‚‰ã‚ŒãŸã‚‰ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼ã‚’å®Ÿè¡Œã—ã¦å†åº¦commit
- ãƒªãƒã‚¸ãƒˆãƒªã«pushã—ã¦ã‹ã‚‰CIã«æ•´å½¢ãŒã§ãã¦ã„ãªã„ã¨æ€’ã‚‰ã‚Œã¦ã‹ã‚‰ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼ã‚’å®Ÿè¡Œã—ã¦å†åº¦push

ã“ã®è¨˜äº‹ã¯ä¸Šè¨˜ã®ã©ã‚Œã‚‚æ¯å›ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼ã§æ•´å½¢ã—ãªãã‚ƒã„ã‘ãªã„ã®ã§é¢å€’è‡­ã„ or ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼ã‚’å®Ÿè¡Œã™ã‚‹ã®å¿˜ã‚ŒãŒã¡ã ã¨æ€ã£ãŸæ–¹å‘ã‘ã«Github Actionsã«ã‚³ãƒ¼ãƒ‰æ•´å½¢ã¨ãã®ã‚³ãƒ¼ãƒ‰æ•´å½¢å¾Œã®ã‚³ãƒŸãƒƒãƒˆã‚’ä¸¸æŠ•ã’ã™ã‚‹ãŸã‚ã®æ–¹æ³•ã‚’æ›¸ã„ãŸè¨˜äº‹ã«ãªã‚Šã¾ã™ã€‚

# ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç®¡ç†

ã“ã®è¨˜äº‹ã§ã¯Poetryã‚’åˆ©ç”¨ã—ã¾ã™ã€‚
Poetryã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•ã«ã¤ã„ã¦ã¯[ã“ã“](https://python-poetry.org/docs/#installation)ã‚’å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚

# ã“ã®è¨˜äº‹ã§åˆ©ç”¨ã™ã‚‹ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼

ä»¥ä¸‹ã®2ã¤ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹ã“ã¨ã‚’æƒ³å®šã—ã¦ã„ã¾ã™ã€‚

- black
- autoflake8

ã¡ãªã¿ã«æœ¬è¨˜äº‹ã§ç´¹ä»‹ã™ã‚‹æ–¹æ³•ã¯ã“ã®2ã¤ã˜ã‚ƒãªã„ã¨è¡Œãˆãªã„ã‚ã‘ã§ã¯ãªãã€è©²å½“ç®‡æ‰€ã‚’åˆ¥ã®ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼ã«å·®ã—æ›¿ãˆã‚Œã°åˆ¥ã®ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼ã§ã‚‚å•é¡Œãªã„ã§ã™ã€‚


# è‡ªå‹•ã‚³ãƒŸãƒƒãƒˆã‚’å®Ÿç¾ã™ã‚‹ãƒ„ãƒ¼ãƒ«

æœ¬è¨˜äº‹ã§ã¯[stefanzweifel/git-auto-commit-action](https://github.com/stefanzweifel/git-auto-commit-action)ã¨ã„ã†ãƒ„ãƒ¼ãƒ«ã‚’æ´»ç”¨ã—ã¾ã™ã€‚

ã“ã®ãƒ„ãƒ¼ãƒ«ã¯Github Actions ã® workflow ã® yamlãƒ•ã‚¡ã‚¤ãƒ«ã«ä»¥ä¸‹ã®ã‚ˆã†ã«æ›¸ã‘ã°åˆ©ç”¨ã§ãã¾ã™ã€‚

```
- uses: stefanzweifel/git-auto-commit-action@v3.0.0
    with:
      commit_message: Apply Code Formatter Change
      ref: ${{ github.head_ref }}
```

commit_message ã‚„ ref ã®ä»–ã«ã‚‚ push ã™ã‚‹ãƒ–ãƒ©ãƒ³ãƒã‚’æŒ‡å®šã—ãŸã‚Šã€commit ã‚„ push æ™‚ã®å¼•æ•°ã‚’æŒ‡å®šã§ããŸã‚Šã‚‚ã—ã¾ã™ã€‚
è©³ã—ãã¯[stefanzweifel/git-auto-commit-action](https://github.com/stefanzweifel/git-auto-commit-action)ã«è¨˜è¼‰ãŒã‚ã‚‹ã®ã§ã€ãã¡ã‚‰ã‚’ç¢ºèªã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

# å®Ÿéš›ã« Github Actions ã§ã‚³ãƒ¼ãƒ‰æ•´å½¢ã¨ã‚³ãƒŸãƒƒãƒˆã‚’è‡ªå‹•åŒ–

ã§ã¯ã€ã“ã®ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã£ã¦å®Ÿéš›ã«Github Actionsã§ã‚³ãƒŸãƒƒãƒˆã‚’è‡ªå‹•åŒ–ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚
ä»Šå›ã¯ Github Actions ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä»¥ä¸‹2ãƒ‘ã‚¿ãƒ¼ãƒ³ç”¨æ„ã—ã¦ã„ã¾ã™ã€‚

- push ã•ã‚ŒãŸæ™‚ã«è‡ªå‹•ã§ã‚³ãƒ¼ãƒ‰ã‚’æ•´å½¢ & ã‚³ãƒŸãƒƒãƒˆã‚’è¡Œã†
- Pull Request ãŒã‚¯ãƒ­ãƒ¼ã‚ºã•ã‚ŒãŸæ™‚ã«è‡ªå‹•ã§ã‚³ãƒ¼ãƒ‰ã‚’æ•´å½¢ & ã‚³ãƒŸãƒƒãƒˆã‚’è¡Œã†

ãã‚Œãã‚Œãƒ¡ãƒªãƒƒãƒˆãƒ»ãƒ‡ãƒ¡ãƒªãƒƒãƒˆãŒã‚ã‚‹ã®ã§ã€å ´åˆã«ã‚ˆã£ã¦ä½¿ã„åˆ†ã‘ã¦ãã ã•ã„ã€‚

## push ã•ã‚ŒãŸæ™‚ã«è‡ªå‹•ã§ã‚³ãƒ¼ãƒ‰ã‚’æ•´å½¢ & ã‚³ãƒŸãƒƒãƒˆã‚’è¡Œã†

ã“ã¡ã‚‰ã¯masterãƒ–ãƒ©ãƒ³ãƒã®ã‚³ãƒŸãƒƒãƒˆãƒ­ã‚°ã‚’æ±šã—ãŸããªã„æ–¹ã«ãŠå‹§ã‚ã®æ–¹æ³•ã§ã™ã€‚

### ãƒ¡ãƒªãƒƒãƒˆ

Pull Request ã«è¿½åŠ ã§ã‚³ãƒŸãƒƒãƒˆã—ãŸæ™‚ã«ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼ãŒèµ°ã‚‹ãŸã‚ã€Pull Request ã®æ™‚ã«åˆ‡ã£ãŸãƒ–ãƒ©ãƒ³ãƒå†…ã«ã‚³ãƒŸãƒƒãƒˆãƒ­ã‚°ãŒå¢—ãˆã‚‹ã€‚ã“ã‚Œã«ã‚ˆã‚Š Squash and Merge ã™ã‚Œã°masterãƒ–ãƒ©ãƒ³ãƒãŒã‚³ãƒŸãƒƒãƒˆãƒ­ã‚°ã§æ±šã‚Œãªã„ã€‚
ãŸã ã—ã€master ã«ç›´æ¥ push ã™ã‚‹ã¨æ±šã‚Œã¦ã—ã¾ã†ãŸã‚ã€æ³¨æ„ãŒå¿…è¦ã€‚

### ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ

ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ã‚³ãƒŸãƒƒãƒˆã‚’è¿½åŠ ã§ push ã™ã‚‹ã¨ãã€`git push -f` ã‚’ã™ã‚‹ã‹ã€ã‚‚ã—ãã¯ã€`git pull` ã—ã¦ã‹ã‚‰ `git push` ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```
name: sample_ci

on:
  push:

jobs:
    formatter:
        name: formatter
        runs-on: ubuntu-latest
        strategy:
            matrix:
                python-version: [3.9.0]
        steps:
          - name: Checkout
            uses: actions/checkout@v2
          - name: Set up Python ${{ matrix.python-version }}
            uses: actions/setup-python@v2
            with:
              python-version: ${{ matrix.python-version }}
          - name: Install Poetry
            run: |
              curl -sSL https://raw.githubusercontent.com/python-poetry/poetry/master/get-poetry.py | python
          - name: Add path for Poetry
            run: echo "$HOME/.poetry/bin" >> $GITHUB_PATH
          - name: Install Dependencies
            run: poetry install --no-interaction
          - name: black
            run: poetry run black .
          - name: autoflake
            run: poetry run autoflake -r .
          - uses: stefanzweifel/git-auto-commit-action@v3.0.0
            with:
              commit_message: Apply Code Formatter Change
              ref: ${{ github.head_ref }}
```

## Pull Request ãŒã‚¯ãƒ­ãƒ¼ã‚ºã•ã‚ŒãŸæ™‚ã«è‡ªå‹•ã§ã‚³ãƒ¼ãƒ‰ã‚’æ•´å½¢ & ã‚³ãƒŸãƒƒãƒˆã‚’è¡Œã†

ã“ã¡ã‚‰ã¯masterãƒ–ãƒ©ãƒ³ãƒã®ã‚³ãƒŸãƒƒãƒˆãƒ­ã‚°ã¯æ±šã‚Œã¦ã‚‚è‰¯ã„ã®ã§ã¨ã«ã‹ãæ¥½ãŒã—ãŸã„äººã«ãŠã™ã™ã‚ã§ã™ã€‚

### ãƒ¡ãƒªãƒƒãƒˆ

ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ã‚³ãƒŸãƒƒãƒˆã‚’è¿½åŠ ã§ push ã™ã‚‹ã¨ãã€`git push -f` ã‚’ã™ã‚‹ã‹ã€ã‚‚ã—ãã¯ã€`git pull` ã—ã¦ã‹ã‚‰ `git push` ãªã©ã®æ‰‹é–“ã®ã‹ã‹ã‚‹ä½œæ¥­ãŒä¸è¦ã«ãªã‚‹ã€‚

### ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ

Pull Request ãŒãƒãƒ¼ã‚¸ã•ã‚ŒãŸå…ˆã«ã‚³ãƒŸãƒƒãƒˆã•ã‚Œã‚‹ã®ã§ã€ãƒãƒ¼ã‚¸å…ˆã®ã‚³ãƒŸãƒƒãƒˆãƒ­ã‚°ãŒæ±šã‚Œã‚„ã™ã„ã§ã™ã€‚

```
name: sample_ci

on:
    pull_request:
        types: [closed]

jobs:
    formatter:
        name: formatter
        runs-on: ubuntu-latest
        strategy:
            matrix:
                python-version: [3.9.0]
        steps:
          - name: Checkout
            uses: actions/checkout@v2
          - name: Set up Python ${{ matrix.python-version }}
            uses: actions/setup-python@v2
            with:
              python-version: ${{ matrix.python-version }}
          - name: Install Poetry
            run: |
              curl -sSL https://raw.githubusercontent.com/python-poetry/poetry/master/get-poetry.py | python
          - name: Add path for Poetry
            run: echo "$HOME/.poetry/bin" >> $GITHUB_PATH
          - name: Install Dependencies
            run: poetry install --no-interaction
          - name: black
            run: poetry run black .
          - name: autoflake
            run: poetry run autoflake -r .
          - uses: stefanzweifel/git-auto-commit-action@v3.0.0
            with:
              commit_message: Apply Code Formatter Change
              ref: ${{ github.head_ref }}
```

# çµ‚ã‚ã‚Šã«

Github Actions ã‚’ä½¿ã£ãŸã‚³ãƒ¼ãƒ‰æ•´å½¢ã¨ã‚³ãƒŸãƒƒãƒˆã®è‡ªå‹•åŒ–ã®æ–¹æ³•ã‚’2ãƒ‘ã‚¿ãƒ¼ãƒ³ç´¹ä»‹ã—ã¾ã—ãŸã€‚
æ‰‹å‹•ã§è¡Œã£ã¦ã„ã‚‹ãŸã‚ã‚³ãƒ¼ãƒ‰ã®æ•´å½¢ã‚’å¿˜ã‚ŒãŒã¡ã ã£ãŸã‚Šã€CI ã‹ pre-commit ã«æ€’ã‚‰ã‚Œã¦ã‹ã‚‰è‡ªåˆ†ã§ä¿®æ­£ã™ã‚‹ã®ãŒé¢å€’è‡­ã„æ–¹ã«ã¯ãŠã™ã™ã‚ã®æ–¹æ³•ã§ã™ã€‚
ã€Œã‚‚ã£ã¨è‰¯ã„æ–¹æ³•ãŒã‚ã‚‹ã‚ˆã€ã¨ã„ã†æ–¹ã¯ã‚³ãƒ¡ãƒ³ãƒˆã«æ›¸ã„ã¦ã„ãŸã ã‘ã‚‹ã¨éå¸¸ã«ã‚ã‚ŠãŒãŸã„ã§ã™ã€‚

# å‚è€ƒæ–‡çŒ®

[GitHub ã«ã‚³ãƒ¼ãƒ‰æ•´å½¢ã—ã¦ã‚‚ã‚‰ãŠã† - GitHub Actions ã§ã‚³ãƒ¼ãƒ‰æ•´å½¢&ã‚³ãƒŸãƒƒãƒˆ](https://qiita.com/Ouvill/items/7b6df0e9b981093b330f)